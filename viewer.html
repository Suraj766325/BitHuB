<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Elite PDF Viewer</title>

<link rel="stylesheet"
href="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf_viewer.min.css"/>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#1b1b1b;
  color:#eee;
}

.toolbar{
  display:flex;
  gap:8px;
  align-items:center;
  padding:10px;
  background:#0f0f0f;
  position:sticky;
  top:0;
  z-index:50;
}

button{
  background:#2b2b2b;
  color:#fff;
  border:1px solid #444;
  padding:6px 12px;
  border-radius:6px;
  cursor:pointer;
}

#layout{
  display:flex;
}

#thumbs{
  width:140px;
  background:#111;
  overflow-y:auto;
  height:calc(100vh - 52px);
  border-right:1px solid #333;
}

.thumb{
  cursor:pointer;
  padding:6px;
}

.thumb canvas{
  width:100%;
}

#viewerWrap{
  flex:1;
  display:flex;
  justify-content:center;
  overflow:auto;
}

#pagesContainer{
  width:100%;
  max-width:1100px;
  padding:20px;
}

.page-wrapper{
  position:relative;
  margin-bottom:18px;
  display:flex;
  justify-content:center;
}

canvas{
  background:#fff;
  box-shadow:0 15px 40px rgba(0,0,0,.6);
}

.textLayer{
  position:absolute;
  inset:0;
  overflow:hidden;
}

#loader{
  position:fixed;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(0,0,0,.7);
  z-index:9999;
  font-size:18px;
}
</style>
</head>

<body>

<div class="toolbar">
<button id="prev">Prev</button>
<button id="next">Next</button>

<span>Page <span id="pageNum">0</span> / <span id="pageCount">0</span></span>

<div style="flex:1"></div>

<button id="zoomOut">-</button>
<button id="zoomIn">+</button>
</div>

<div id="layout">
<div id="thumbs"></div>

<div id="viewerWrap">
<div id="pagesContainer"></div>
</div>
</div>

<div id="loader">Loading PDF...</div>

<script>
function loadPdfJs(){
return new Promise((resolve,reject)=>{
if(window.pdfjsLib) return resolve();

const s=document.createElement('script');
s.src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.min.js';

s.onload=()=>{
const v=document.createElement('script');
v.src='https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf_viewer.min.js';
v.onload=resolve;
v.onerror=reject;
document.head.appendChild(v);
};

s.onerror=reject;
document.head.appendChild(s);
});
}

const params=new URLSearchParams(location.search);
const file=params.get('file');

if(!file){
document.body.innerHTML='<h2 style="padding:20px">No PDF specified.</h2>';
throw new Error('Missing file');
}

(async function(){

await loadPdfJs();

pdfjsLib.GlobalWorkerOptions.workerSrc=
'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.16.105/pdf.worker.min.js';

const thumbs=document.getElementById('thumbs');
const pagesContainer=document.getElementById('pagesContainer');
const loader=document.getElementById('loader');

let pdfDoc;
let scale=1;
let currentPage=1;
const rendered=new Set();

const pageNum=document.getElementById('pageNum');
const pageCount=document.getElementById('pageCount');

pdfDoc=await pdfjsLib.getDocument({
url:file,
rangeChunkSize:65536
}).promise;

loader.style.display='none';

pageCount.textContent=pdfDoc.numPages;

const firstPage=await pdfDoc.getPage(1);
const baseViewport=firstPage.getViewport({scale:1});

scale=(pagesContainer.clientWidth0.95)/baseViewport.width;

function createPage(pageNumber){

const wrapper=document.createElement('div');
wrapper.className='page-wrapper';
wrapper.dataset.page=pageNumber;

const canvas=document.createElement('canvas');
const textLayer=document.createElement('div');
textLayer.className='textLayer';

wrapper.appendChild(canvas);
wrapper.appendChild(textLayer);

pagesContainer.appendChild(wrapper);

return {wrapper,canvas,textLayer};
}

async function render(pageNumber,canvas,textLayer){

const page=await pdfDoc.getPage(pageNumber);

const outputScale=window.devicePixelRatio||1;
const viewport=page.getViewport({scale});

canvas.width=Math.floor(viewport.widthoutputScale);
canvas.height=Math.floor(viewport.heightoutputScale);

canvas.style.width=viewport.width+'px';
canvas.style.height=viewport.height+'px';

const ctx=canvas.getContext('2d');
ctx.setTransform(outputScale,0,0,outputScale,0,0);

await page.render({
canvasContext:ctx,
viewport
}).promise;

const text=await page.getTextContent();

textLayer.style.width=viewport.width+'px';
textLayer.style.height=viewport.height+'px';

pdfjsLib.renderTextLayer({
textContent:text,
container:textLayer,
viewport,
textDivs:[]
});

pageNum.textContent=currentPage;
}

for(let i=1;i<=pdfDoc.numPages;i++){

const {wrapper,canvas,textLayer}=createPage(i);

observer.observe(wrapper);

const thumbCanvas=document.createElement('canvas');
const thumbWrap=document.createElement('div');
thumbWrap.className='thumb';
thumbWrap.appendChild(thumbCanvas);
thumbs.appendChild(thumbWrap);

pdfDoc.getPage(i).then(p=>{
const vp=p.getViewport({scale:.25});
thumbCanvas.width=vp.width;
thumbCanvas.height=vp.height;
p.render({canvasContext:thumbCanvas.getContext('2d'),viewport:vp});
});

thumbWrap.onclick=()=>{
document.querySelector('[data-page="'+i+'"]')
.scrollIntoView({behavior:'smooth'});
};
}

const observer=new IntersectionObserver(entries=>{

entries.forEach(entry=>{

if(!entry.isIntersecting) return;

const page=Number(entry.target.dataset.page);

currentPage=page;

if(rendered.has(page)) return;

rendered.add(page);

const canvas=entry.target.querySelector('canvas');
const textLayer=entry.target.querySelector('.textLayer');

render(page,canvas,textLayer);

});
},{threshold:.15});

function rerender(){

document.querySelectorAll('.page-wrapper').forEach(w=>{

const p=Number(w.dataset.page);
if(!rendered.has(p)) return;

const canvas=w.querySelector('canvas');
const textLayer=w.querySelector('.textLayer');

canvas.getContext('2d').clearRect(0,0,canvas.width,canvas.height);
textLayer.innerHTML='';

render(p,canvas,textLayer);
});
}

document.getElementById('zoomIn').onclick=()=>{
scale=Math.min(scale+.15,5);
requestAnimationFrame(rerender);
};

document.getElementById('zoomOut').onclick=()=>{
scale=Math.max(scale-.15,.3);
requestAnimationFrame(rerender);
};

document.getElementById('prev').onclick=()=>{
const target=Math.max(1,currentPage-1);
document.querySelector('[data-page="'+target+'"]').scrollIntoView({behavior:'smooth'});
};

document.getElementById('next').onclick=()=>{
const target=Math.min(pdfDoc.numPages,currentPage+1);
document.querySelector('[data-page="'+target+'"]').scrollIntoView({behavior:'smooth'});
};

window.addEventListener('resize',async()=>{

const vp=(await pdfDoc.getPage(1)).getViewport({scale:1});
scale=(pagesContainer.clientWidth0.95)/vp.width;
rerender();
});

let lastDist=null;

document.addEventListener('touchmove',e=>{

if(e.touches.length!==2){
lastDist=null;
return;
}

const dx=e.touches[0].clientX-e.touches[1].clientX;
const dy=e.touches[0].clientY-e.touches[1].clientY;

const dist=Math.sqrt(dxdx+dydy);

if(lastDist){

if(dist>lastDist){
scale=Math.min(scale+.03,5);
}else{
scale=Math.max(scale-.03,.3);
}

requestAnimationFrame(rerender);
}

lastDist=dist;

},{passive:true});

document.addEventListener('contextmenu',e=>e.preventDefault());

})();
</script>
</body>
</html>